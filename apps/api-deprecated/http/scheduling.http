### Autoscheduling API Tests
# Uses REST Client style like apps/api/auth.http

@baseUrl = http://localhost:5001/api
@contentType = application/json

### Health Check
GET {{baseUrl}}/health

###
# AUTH — login as existing user (ensure the account exists)
###

# @name login
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "hanifcarroll@gmail.com",
  "password": "Password1!"
}

###
# LINKEDIN STATUS (must be connected for scheduling/publishing)
###

GET {{baseUrl}}/auth/linkedin/status
Authorization: Bearer {{login.response.body.token}}

### Start LinkedIn OAuth (returns URL to open in browser)
GET {{baseUrl}}/auth/linkedin/auth
Authorization: Bearer {{login.response.body.token}}

###
# SCHEDULING PREFERENCES
###

### Get preferences (404 if not configured yet)
GET {{baseUrl}}/scheduling/preferences
Authorization: Bearer {{login.response.body.token}}

### Set or update preferences (IANA timezone + lead time minutes)
PUT {{baseUrl}}/scheduling/preferences
Authorization: Bearer {{login.response.body.token}}
Content-Type: {{contentType}}

{
  "timezone": "America/New_York",
  "leadTimeMinutes": 30
}

### Get preferences (should be 200 now)
GET {{baseUrl}}/scheduling/preferences
Authorization: Bearer {{login.response.body.token}}

###
# TIMESLOTS (ISO weekdays: Monday=1 … Sunday=7)
###

### Replace all preferred timeslots (must be non-empty)
PUT {{baseUrl}}/scheduling/slots
Authorization: Bearer {{login.response.body.token}}
Content-Type: {{contentType}}

{
  "items": [
    { "isoDayOfWeek": 1, "time": "09:00" },
    { "isoDayOfWeek": 3, "time": "09:00" },
    { "isoDayOfWeek": 5, "time": "09:00" },
    { "isoDayOfWeek": 2, "time": "11:30" },
    { "isoDayOfWeek": 4, "time": "14:00" }
  ]
}

### List active timeslots
GET {{baseUrl}}/scheduling/slots
Authorization: Bearer {{login.response.body.token}}

###
# PROJECT/POSTS VARIABLES — set your own IDs below
###

@projectId = 2
@postId = 21

### (Optional) List posts for a project
GET {{baseUrl}}/posts/projects/{{projectId}}/posts?page=1&pageSize=20
Authorization: Bearer {{login.response.body.token}}

### (Optional) Approve a post so it can be scheduled
PATCH {{baseUrl}}/posts/posts/{{postId}}
Authorization: Bearer {{login.response.body.token}}
Content-Type: {{contentType}}

{
  "status": "approved"
}

###
# AUTOSCHEDULE — SINGLE POST
###

POST {{baseUrl}}/posts/posts/{{postId}}/auto-schedule
Authorization: Bearer {{login.response.body.token}}

### List scheduled posts (global, paginated)
GET {{baseUrl}}/posts/posts/scheduled?page=1&pageSize=10
Authorization: Bearer {{login.response.body.token}}

###
# AUTOSCHEDULE — ALL APPROVED POSTS IN PROJECT
###

POST {{baseUrl}}/posts/projects/{{projectId}}/posts/auto-schedule
Authorization: Bearer {{login.response.body.token}}
Content-Type: {{contentType}}

{
  "limit": 10
}

### List scheduled posts again
GET {{baseUrl}}/posts/posts/scheduled?page=1&pageSize=20
Authorization: Bearer {{login.response.body.token}}

###
# (Optional) Unschedule a post
###

DELETE {{baseUrl}}/posts/posts/{{postId}}/schedule
Authorization: Bearer {{login.response.body.token}}
