<div class="scheduling-panel bg-white rounded-lg shadow-sm">
  <p-tabView>
    <!-- Schedule Tab -->
    <p-tabPanel header="Schedule Posts" leftIcon="pi pi-calendar">
      <div class="p-6">
        <!-- Bulk Schedule Option -->
        <div class="mb-4 p-4 bg-blue-50 rounded-lg">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-medium text-blue-900 mb-1">Bulk Schedule</h3>
              <p class="text-sm text-blue-700">
                Automatically schedule all approved posts at optimal times
              </p>
            </div>
            <button 
              pButton 
              label="Auto-Schedule All"
              icon="pi pi-bolt"
              class="p-button-primary"
              [disabled]="availablePosts().length === 0"
              (click)="scheduleBulkPosts()">
            </button>
          </div>
        </div>

        <!-- Manual Scheduling -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Post Selection -->
          <div>
            <h3 class="font-medium mb-3">Select Post</h3>
            <div class="post-list space-y-2 max-h-96 overflow-y-auto">
              @for (post of availablePosts(); track post.id) {
                <div 
                  class="post-item p-3 border rounded-lg cursor-pointer transition-all"
                  [class.selected]="selectedPost()?.id === post.id"
                  (click)="selectPost(post)">
                  <div class="flex items-start justify-between mb-2">
                    <div class="flex gap-2">
                      @for (platform of post.platforms; track platform) {
                        <i [class]="getPlatformIcon(platform) + ' text-sm'"></i>
                      }
                    </div>
                    <p-tag 
                      [value]="post.type"
                      severity="secondary"
                      styleClass="text-xs">
                    </p-tag>
                  </div>
                  <p class="text-sm text-gray-700 line-clamp-3">{{ post.content }}</p>
                  @if (post.hashtags && post.hashtags.length > 0) {
                    <div class="flex gap-1 flex-wrap mt-2">
                      @for (tag of post.hashtags.slice(0, 3); track tag) {
                        <p-chip [label]="'#' + tag" styleClass="text-xs"></p-chip>
                      }
                      @if (post.hashtags.length > 3) {
                        <span class="text-xs text-gray-500">+{{ post.hashtags.length - 3 }} more</span>
                      }
                    </div>
                  }
                </div>
              } @empty {
                <div class="text-center py-8 text-gray-500">
                  <i class="pi pi-inbox text-3xl mb-2"></i>
                  <p>No posts available for scheduling</p>
                  <p class="text-sm">Approve some posts first</p>
                </div>
              }
            </div>
          </div>

          <!-- Scheduling Options -->
          <div>
            <h3 class="font-medium mb-3">Schedule Settings</h3>
            
            @if (selectedPost()) {
              <!-- Platform Selection -->
              @if (selectedPost()!.platforms && selectedPost()!.platforms!.length > 1) {
                <div class="mb-4">
                  <label class="block text-sm font-medium mb-2">Platform</label>
                  <div class="flex gap-2">
                    @for (platform of selectedPost()!.platforms; track platform) {
                      <button 
                        pButton 
                        [label]="platform"
                        [icon]="getPlatformIcon(platform)"
                        [class.p-button-outlined]="selectedPlatform() !== platform"
                        class="p-button-sm"
                        (click)="selectPlatform(platform)">
                      </button>
                    }
                  </div>
                </div>
              }

              <!-- Optimal Time Suggestion -->
              @if (useOptimalTime() && selectedPlatform()) {
                @if (optimalTimesSignal().find(o => o.platform === selectedPlatform()); as optimal) {
                  <div class="mb-4 p-3 bg-green-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                      <span class="text-sm font-medium text-green-800">
                        <i class="pi pi-star-fill text-green-600 mr-1"></i>
                        Optimal Time
                      </span>
                      <p-tag 
                        [value]="optimal.engagementScore + '% engagement'"
                        severity="success"
                        styleClass="text-xs">
                      </p-tag>
                    </div>
                    <p class="text-sm text-green-700">
                      {{ optimal.dayOfWeek }} at {{ optimal.time }}
                    </p>
                    <p class="text-xs text-green-600 mt-1">{{ optimal.reason }}</p>
                  </div>
                }
              }

              <!-- Date & Time Selection -->
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Date</label>
                  <p-calendar 
                    [(ngModel)]="selectedDate"
                    [showIcon]="true"
                    [minDate]="new Date()"
                    dateFormat="mm/dd/yy">
                  </p-calendar>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Time</label>
                  <input 
                    type="time" 
                    pInputText
                    [(ngModel)]="selectedTime"
                    class="w-full">
                </div>
              </div>

              <!-- Timezone Selection -->
              <div class="mb-4">
                <label class="block text-sm font-medium mb-2">Timezone</label>
                <p-dropdown 
                  [(ngModel)]="selectedTimezone"
                  [options]="timezones"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Select timezone"
                  styleClass="w-full">
                </p-dropdown>
              </div>

              <!-- Schedule Button -->
              <button 
                pButton 
                label="Schedule Post"
                icon="pi pi-check"
                class="p-button-success w-full"
                [disabled]="!selectedPlatform()"
                (click)="scheduleSelectedPost()">
              </button>
            } @else {
              <div class="text-center py-8 text-gray-400">
                <i class="pi pi-arrow-left text-3xl mb-2"></i>
                <p>Select a post to schedule</p>
              </div>
            }
          </div>
        </div>
      </div>
    </p-tabPanel>

    <!-- Scheduled Tab -->
    <p-tabPanel header="Scheduled" [leftIcon]="'pi pi-clock'" [badge]="scheduledPosts().length.toString()">
      <div class="p-6">
        <p-dataView 
          [value]="scheduledPosts()" 
          [paginator]="true" 
          [rows]="10"
          [sortField]="'scheduledTime'"
          [sortOrder]="1">
          <ng-template pTemplate="list" let-items>
            <div class="space-y-3">
              @for (item of items; track item.id) {
                <div class="scheduled-item p-4 border rounded-lg hover:shadow-md transition-shadow">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <div class="flex items-center gap-3 mb-2">
                        <i [class]="getPlatformIcon(item.platform) + ' text-lg'"></i>
                        <span class="font-medium">{{ formatScheduledTime(item.scheduledTime) }}</span>
                        <p-tag 
                          [value]="item.status"
                          [severity]="getStatusSeverity(item.status)">
                        </p-tag>
                      </div>
                      @if (item.post) {
                        <p class="text-sm text-gray-700 line-clamp-2">{{ item.post.content }}</p>
                      }
                    </div>
                    <div class="flex gap-2">
                      <button 
                        pButton 
                        icon="pi pi-send"
                        pTooltip="Publish Now"
                        tooltipPosition="top"
                        class="p-button-sm p-button-text p-button-success"
                        (click)="publishPostNow(item.postId)">
                      </button>
                      <button 
                        pButton 
                        icon="pi pi-times"
                        pTooltip="Cancel Schedule"
                        tooltipPosition="top"
                        class="p-button-sm p-button-text p-button-danger"
                        (click)="cancelScheduleSlot(item.id)">
                      </button>
                    </div>
                  </div>
                </div>
              }
            </div>
          </ng-template>
          <ng-template pTemplate="empty">
            <div class="text-center py-8 text-gray-500">
              <i class="pi pi-calendar-times text-3xl mb-2"></i>
              <p>No scheduled posts</p>
            </div>
          </ng-template>
        </p-dataView>
      </div>
    </p-tabPanel>

    <!-- Published Tab -->
    <p-tabPanel header="Published" leftIcon="pi pi-check-circle" [badge]="publishedPosts().length.toString()">
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          @for (item of publishedPosts(); track item.id) {
            <p-card>
              <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-3">
                  <i [class]="getPlatformIcon(item.platform) + ' text-xl'"></i>
                  <p-tag 
                    value="Published"
                    severity="success">
                  </p-tag>
                </div>
              </ng-template>
              
              @if (item.post) {
                <p class="text-sm text-gray-700 mb-3 line-clamp-3">{{ item.post.content }}</p>
              }
              
              <div class="text-xs text-gray-500 mb-3">
                Published: {{ formatScheduledTime(item.scheduledTime) }}
              </div>
              
              @if (item.publishedUrl) {
                <a 
                  [href]="item.publishedUrl" 
                  target="_blank"
                  class="text-blue-600 hover:underline text-sm flex items-center gap-1">
                  View Post <i class="pi pi-external-link text-xs"></i>
                </a>
              }
              
              @if (item.analytics) {
                <div class="mt-3 pt-3 border-t">
                  <div class="grid grid-cols-2 gap-2 text-xs">
                    @if (item.analytics.views !== undefined) {
                      <div>
                        <span class="text-gray-500">Views:</span>
                        <span class="font-medium ml-1">{{ item.analytics.views }}</span>
                      </div>
                    }
                    @if (item.analytics.likes !== undefined) {
                      <div>
                        <span class="text-gray-500">Likes:</span>
                        <span class="font-medium ml-1">{{ item.analytics.likes }}</span>
                      </div>
                    }
                    @if (item.analytics.shares !== undefined) {
                      <div>
                        <span class="text-gray-500">Shares:</span>
                        <span class="font-medium ml-1">{{ item.analytics.shares }}</span>
                      </div>
                    }
                    @if (item.analytics.comments !== undefined) {
                      <div>
                        <span class="text-gray-500">Comments:</span>
                        <span class="font-medium ml-1">{{ item.analytics.comments }}</span>
                      </div>
                    }
                  </div>
                </div>
              }
            </p-card>
          }
        </div>
        
        @if (publishedPosts().length === 0) {
          <div class="text-center py-8 text-gray-500">
            <i class="pi pi-send text-3xl mb-2"></i>
            <p>No published posts yet</p>
          </div>
        }
      </div>
    </p-tabPanel>

    <!-- Calendar View Tab -->
    <p-tabPanel header="Calendar View" leftIcon="pi pi-calendar-plus">
      <div class="p-6">
        <div class="calendar-legend mb-4 flex gap-4">
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
            <span class="text-sm">Scheduled</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="w-3 h-3 bg-green-500 rounded-full"></span>
            <span class="text-sm">Published</span>
          </div>
        </div>
        
        <!-- Calendar implementation would go here -->
        <!-- For now, showing a list view of calendar events -->
        <div class="calendar-events space-y-2">
          @for (event of calendarEvents(); track event.id) {
            <div class="event-item flex items-center gap-3 p-3 border rounded-lg"
                 [class.bg-blue-50]="event.status === 'scheduled'"
                 [class.bg-green-50]="event.status === 'published'">
              <div class="text-center">
                <div class="text-2xl font-bold">{{ event.start.getDate() }}</div>
                <div class="text-xs text-gray-500">
                  {{ event.start.toLocaleDateString('en-US', { month: 'short' }) }}
                </div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <i [class]="getPlatformIcon(event.platform) + ' text-sm'"></i>
                  <span class="text-sm font-medium">{{ event.title }}</span>
                </div>
                <div class="text-xs text-gray-500">
                  {{ event.start.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true }) }}
                </div>
              </div>
              <p-tag 
                [value]="event.status"
                [severity]="getStatusSeverity(event.status)"
                styleClass="text-xs">
              </p-tag>
            </div>
          } @empty {
            <div class="text-center py-8 text-gray-500">
              <i class="pi pi-calendar text-3xl mb-2"></i>
              <p>No scheduled events</p>
            </div>
          }
        </div>
      </div>
    </p-tabPanel>
  </p-tabView>
}